<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة المستخدمين - لوحة التحكم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #c00a27;
            --primary-dark: #8a001a;
            --primary-light: #ff4d6d;
            --secondary: #000000;
            --secondary-light: #1a1a1a;
            --light: #f5f5f5;
            --text: #333333;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: var(--light);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* الشريط العلوي للوحة التحكم */
        .admin-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .admin-navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 22px;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-weight: bold;
        }

        .user-role {
            font-size: 14px;
            opacity: 0.8;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
        }

        /* تخطيط لوحة التحكم */
        .dashboard-layout {
            display: flex;
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        /* الشريط الجانبي */
        .sidebar {
            width: 250px;
            background: rgba(30, 30, 30, 0.95);
            padding: 30px 0;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            position: fixed;
            right: 0;
            top: 80px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .menu-title {
            padding: 15px 25px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-links {
            list-style: none;
        }

        .menu-links li {
            margin-bottom: 5px;
        }

        .menu-links a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }

        .menu-links a:hover,
        .menu-links a.active {
            background: rgba(192, 10, 39, 0.1);
            color: white;
            border-right-color: var(--primary);
        }

        .menu-links a i {
            width: 20px;
            text-align: center;
        }

        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            margin-right: 250px;
            padding: 30px;
        }

        .dashboard-header {
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: bold;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(192, 10, 39, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #1e7e34 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e0a800 100%);
            color: #212529;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #bd2130 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, #117a8b 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* إحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(60, 60, 60, 0.9) 100%);
            border-radius: var(--radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.total { background: var(--info); }
        .stat-icon.active { background: var(--success); }
        .stat-icon.inactive { background: var(--warning); }
        .stat-icon.admin { background: var(--primary); }

        .stat-info h3 {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* جدول المستخدمين */
        .users-table {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(60, 60, 60, 0.9) 100%);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-header h2 {
            font-size: 24px;
        }

        .table-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            position: relative;
            width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: white;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(50, 50, 50, 0.95);
            border-radius: var(--radius);
            padding: 10px 0;
            min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .filter-menu.active {
            display: block;
        }

        .filter-option {
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-option:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .filter-option.active {
            color: var(--primary);
            background: rgba(192, 10, 39, 0.1);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(192, 10, 39, 0.1);
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        th {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .user-info-cell {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name-cell {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .user-email-cell {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .role-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 80px;
        }

        .role-admin { background: rgba(192, 10, 39, 0.2); color: var(--primary); }
        .role-editor { background: rgba(23, 162, 184, 0.2); color: var(--info); }
        .role-viewer { background: rgba(108, 117, 125, 0.2); color: #6c757d; }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 80px;
        }

        .status-active { background: rgba(40, 167, 69, 0.2); color: var(--success); }
        .status-inactive { background: rgba(108, 117, 125, 0.2); color: #6c757d; }
        .status-suspended { background: rgba(220, 53, 69, 0.2); color: var(--danger); }

        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* الشاشات المنبثقة */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.95) 0%, rgba(60, 60, 60, 0.95) 100%);
            border-radius: var(--radius);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-size: 24px;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: white;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(192, 10, 39, 0.1);
        }

        .password-input-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 16px;
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .user-details-view {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail-label {
            width: 150px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            flex-shrink: 0;
        }

        .detail-value {
            flex: 1;
            color: white;
        }

        .avatar-preview {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-display {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 48px;
            color: white;
            border: 4px solid rgba(255, 255, 255, 0.1);
        }

        .avatar-initials {
            font-size: 36px;
            font-weight: bold;
        }

        .permissions-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .permission-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .permission-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .permission-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        /* رسائل التأكيد */
        .confirmation-modal {
            text-align: center;
            padding: 40px 30px;
        }

        .confirmation-icon {
            font-size: 60px;
            color: var(--danger);
            margin-bottom: 20px;
        }

        .confirmation-text h3 {
            margin-bottom: 15px;
            color: white;
        }

        .confirmation-text p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        /* تحسينات التجاوب */
        @media (max-width: 1200px) {
            .dashboard-layout {
                flex-direction: column;
            }
            
            .sidebar {
                position: relative;
                width: 100%;
                top: 0;
                height: auto;
                margin-bottom: 30px;
            }
            
            .main-content {
                margin-right: 0;
            }
        }

        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .permissions-grid {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .search-box, .filter-dropdown {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .table-header {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal {
                width: 95%;
                max-height: 85vh;
            }
            
            .modal-header, .modal-body, .modal-footer {
                padding: 20px;
            }
            
            .user-info-cell {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .btn-small {
                width: 100%;
            }
            
            .detail-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .detail-label {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- شريط الرأس العلوي -->
    <header class="admin-header">
        <div class="container">
            <nav class="admin-navbar">
                <a href="dashboard.html" class="admin-logo">
                    <i class="fas fa-network-wired"></i>
                    <span>دوت نت - لوحة التحكم</span>
                </a>
                
                <div class="admin-user">
                    <div class="user-info">
                        <div class="user-name">أحمد محمد</div>
                        <div class="user-role">مدير النظام</div>
                    </div>
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- تخطيط لوحة التحكم -->
    <div class="dashboard-layout">
        <!-- الشريط الجانبي -->
        <aside class="sidebar">
            <div class="menu-title">القائمة الرئيسية</div>
            <ul class="menu-links">
                <li><a href="dashboard.html"><i class="fas fa-home"></i> الرئيسية</a></li>
                <li><a href="dashboard-messages.html"><i class="fas fa-envelope"></i> رسائل اتصل بنا</a></li>
                <li><a href="dashboard-services-requests.html"><i class="fas fa-tasks"></i> طلبات الخدمات</a></li>
                <li><a href="dashboard-services.html"><i class="fas fa-laptop-code"></i> الخدمات</a></li>
                <li><a href="dashboard-ads.html"><i class="fas fa-bullhorn"></i> الإعلانات</a></li>
                <li><a href="dashboard-contact.html"><i class="fas fa-address-book"></i> بيانات الاتصال</a></li>
                <li><a href="dashboard-users.html" class="active"><i class="fas fa-users"></i> المستخدمين</a></li>
                <li><a href="dashboard-settings.html"><i class="fas fa-cog"></i> الإعدادات</a></li>
            </ul>
            
            <div class="menu-title">حسابات</div>
            <ul class="menu-links">
                <li><a href="index.html"><i class="fas fa-globe"></i> زيارة الموقع</a></li>
                <li><a href="#"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a></li>
            </ul>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <div class="dashboard-header">
                <div>
                    <h1>إدارة المستخدمين</h1>
                    <p>إضافة وتعديل وإدارة حسابات المستخدمين في لوحة التحكم</p>
                </div>
                <button class="btn" onclick="openAddUserModal()">
                    <i class="fas fa-user-plus"></i> إضافة مستخدم جديد
                </button>
            </div>

            <!-- إحصائيات -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>إجمالي المستخدمين</h3>
                        <div class="stat-number" id="totalCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon active">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3>نشط</h3>
                        <div class="stat-number" id="activeCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon inactive">
                        <i class="fas fa-user-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3>غير نشط</h3>
                        <div class="stat-number" id="inactiveCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon admin">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="stat-info">
                        <h3>مديرين</h3>
                        <div class="stat-number" id="adminCount">0</div>
                    </div>
                </div>
            </div>

            <!-- جدول المستخدمين -->
            <div class="users-table">
                <div class="table-header">
                    <h2>قائمة المستخدمين</h2>
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="بحث في المستخدمين...">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="filter-dropdown">
                            <button class="filter-btn" onclick="toggleFilterMenu()">
                                <i class="fas fa-filter"></i>
                                <span id="filterText">جميع المستخدمين</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="filter-menu" id="filterMenu">
                                <div class="filter-option active" data-filter="all">جميع المستخدمين</div>
                                <div class="filter-option" data-filter="admin">مديرين</div>
                                <div class="filter-option" data-filter="editor">محررين</div>
                                <div class="filter-option" data-filter="viewer">مشاهدين</div>
                                <div class="filter-option" data-filter="active">نشط</div>
                                <div class="filter-option" data-filter="inactive">غير نشط</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th width="60">#</th>
                                <th>المستخدم</th>
                                <th>الدور</th>
                                <th>تاريخ الإضافة</th>
                                <th>الحالة</th>
                                <th>آخر نشاط</th>
                                <th width="200">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- سيتم ملء الجدول بالبيانات من JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- الشاشات المنبثقة -->

    <!-- شاشة عرض تفاصيل المستخدم -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal">
            <div class="modal-header">
                <h2>تفاصيل المستخدم</h2>
                <button class="modal-close" onclick="closeModal('viewModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="avatar-preview">
                    <div class="avatar-display" id="viewAvatarDisplay">
                        <span class="avatar-initials" id="viewAvatarInitials">أم</span>
                    </div>
                    <h3 id="viewFullName">أحمد محمد</h3>
                    <p id="viewUserRole">مدير النظام</p>
                </div>
                
                <div class="user-details-view">
                    <div class="detail-row">
                        <span class="detail-label">اسم المستخدم:</span>
                        <span class="detail-value" id="viewUsername">ahmed</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">البريد الإلكتروني:</span>
                        <span class="detail-value" id="viewEmail">ahmed@example.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">رقم الهاتف:</span>
                        <span class="detail-value" id="viewPhone">+966501234567</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">الدور:</span>
                        <span class="detail-value">
                            <span class="role-badge" id="viewRoleBadge">مدير</span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">الحالة:</span>
                        <span class="detail-value">
                            <span class="status-badge" id="viewStatusBadge">نشط</span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">تاريخ التسجيل:</span>
                        <span class="detail-value" id="viewJoinDate">2023-10-01</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">آخر نشاط:</span>
                        <span class="detail-value" id="viewLastActivity">2023-10-15 14:30</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">عنوان IP:</span>
                        <span class="detail-value" id="viewLastIP">192.168.1.1</span>
                    </div>
                </div>
                
                <div class="permissions-section">
                    <h4>الصلاحيات:</h4>
                    <div class="permissions-grid" id="viewPermissionsGrid">
                        <!-- سيتم ملء الصلاحيات من JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-success" onclick="activateUser()">
                    <i class="fas fa-check-circle"></i> تفعيل
                </button>
                <button class="btn btn-warning" onclick="openEditUserModal()">
                    <i class="fas fa-edit"></i> تعديل
                </button>
                <button class="btn btn-danger" onclick="openDeleteModal()">
                    <i class="fas fa-trash"></i> حذف
                </button>
            </div>
        </div>
    </div>
    
    <!-- شاشة إضافة مستخدم جديد -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <div class="modal-header">
                <h2>إضافة مستخدم جديد</h2>
                <button class="modal-close" onclick="closeModal('addModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="avatar-preview">
                        <div class="avatar-display" id="addAvatarDisplay">
                            <span class="avatar-initials" id="addAvatarInitials">م</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addFirstName">الاسم الأول *</label>
                            <input type="text" id="addFirstName" class="form-control" required oninput="updateAddAvatar()">
                        </div>
                        
                        <div class="form-group">
                            <label for="addLastName">اسم العائلة *</label>
                            <input type="text" id="addLastName" class="form-control" required oninput="updateAddAvatar()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addUsername">اسم المستخدم *</label>
                            <input type="text" id="addUsername" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="addEmail">البريد الإلكتروني *</label>
                            <input type="email" id="addEmail" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addPassword">كلمة المرور *</label>
                            <div class="password-input-container">
                                <input type="password" id="addPassword" class="form-control" required>
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('addPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="addConfirmPassword">تأكيد كلمة المرور *</label>
                            <div class="password-input-container">
                                <input type="password" id="addConfirmPassword" class="form-control" required>
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('addConfirmPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addPhone">رقم الهاتف</label>
                            <input type="tel" id="addPhone" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="addRole">الدور *</label>
                            <select id="addRole" class="form-control" required>
                                <option value="">اختر الدور</option>
                                <option value="admin">مدير</option>
                                <option value="editor">محرر</option>
                                <option value="viewer">مشاهد</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addStatus">حالة الحساب *</label>
                            <select id="addStatus" class="form-control" required>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="permissions-section">
                        <h4>الصلاحيات:</h4>
                        <div class="permissions-grid" id="addPermissionsGrid">
                            <!-- سيتم ملء الصلاحيات من JavaScript -->
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveNewUser()">
                    <i class="fas fa-save"></i> حفظ المستخدم
                </button>
                <button class="btn btn-outline" onclick="closeModal('addModal')">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- شاشة تعديل المستخدم -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h2>تعديل بيانات المستخدم</h2>
                <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    
                    <div class="avatar-preview">
                        <div class="avatar-display" id="editAvatarDisplay">
                            <span class="avatar-initials" id="editAvatarInitials">م</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editFirstName">الاسم الأول *</label>
                            <input type="text" id="editFirstName" class="form-control" required oninput="updateEditAvatar()">
                        </div>
                        
                        <div class="form-group">
                            <label for="editLastName">اسم العائلة *</label>
                            <input type="text" id="editLastName" class="form-control" required oninput="updateEditAvatar()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editUsername">اسم المستخدم *</label>
                            <input type="text" id="editUsername" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editEmail">البريد الإلكتروني *</label>
                            <input type="email" id="editEmail" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editPassword">كلمة المرور الجديدة (اختياري)</label>
                            <div class="password-input-container">
                                <input type="password" id="editPassword" class="form-control">
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('editPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small style="color: rgba(255,255,255,0.6);">اتركه فارغاً إذا كنت لا تريد تغيير كلمة المرور</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPhone">رقم الهاتف</label>
                            <input type="tel" id="editPhone" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRole">الدور *</label>
                            <select id="editRole" class="form-control" required>
                                <option value="">اختر الدور</option>
                                <option value="admin">مدير</option>
                                <option value="editor">محرر</option>
                                <option value="viewer">مشاهد</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editStatus">حالة الحساب *</label>
                            <select id="editStatus" class="form-control" required>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                                <option value="suspended">موقوف</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="permissions-section">
                        <h4>الصلاحيات:</h4>
                        <div class="permissions-grid" id="editPermissionsGrid">
                            <!-- سيتم ملء الصلاحيات من JavaScript -->
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveEditUser()">
                    <i class="fas fa-save"></i> حفظ التعديلات
                </button>
                <button class="btn btn-danger" onclick="openDeleteModal()">
                    <i class="fas fa-trash"></i> حذف المستخدم
                </button>
                <button class="btn btn-outline" onclick="closeModal('editModal')">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- شاشة تأكيد الحذف -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <h2>تأكيد حذف المستخدم</h2>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="confirmation-modal">
                    <div class="confirmation-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="confirmation-text">
                        <h3>هل أنت متأكد من حذف هذا المستخدم؟</h3>
                        <p>هذا الإجراء لا يمكن التراجع عنه. سيتم حذف جميع بيانات المستخدم بما في ذلك سجل الأنشطة.</p>
                        <p><strong>ملاحظة:</strong> لا يمكن حذف حساب المدير الرئيسي للنظام.</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> نعم، احذف المستخدم
                </button>
                <button class="btn btn-outline" onclick="closeModal('deleteModal')">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <script>
        // بيانات تجريبية للمستخدمين
        let users = [
            {
                id: 1,
                firstName: "أحمد",
                lastName: "محمد",
                username: "ahmed",
                email: "ahmed@example.com",
                phone: "+966501234567",
                role: "admin",
                status: "active",
                joinDate: "2023-10-01",
                lastActivity: "2023-10-15 14:30",
                lastIP: "192.168.1.1",
                permissions: ["dashboard", "users", "messages", "services", "ads", "settings"]
            },
            {
                id: 2,
                firstName: "سارة",
                lastName: "عبدالله",
                username: "sara",
                email: "sara@example.com",
                phone: "+966552345678",
                role: "editor",
                status: "active",
                joinDate: "2023-10-05",
                lastActivity: "2023-10-14 10:15",
                lastIP: "192.168.1.2",
                permissions: ["dashboard", "messages", "services", "ads"]
            },
            {
                id: 3,
                firstName: "خالد",
                lastName: "الرشيد",
                username: "khalid",
                email: "khalid@example.com",
                phone: "+966503456789",
                role: "viewer",
                status: "inactive",
                joinDate: "2023-10-10",
                lastActivity: "2023-10-12 09:45",
                lastIP: "192.168.1.3",
                permissions: ["dashboard", "messages"]
            }
        ];

        // قائمة الصلاحيات
        const allPermissions = [
            { id: "dashboard", name: "لوحة التحكم", description: "الوصول إلى لوحة التحكم الرئيسية" },
            { id: "users", name: "إدارة المستخدمين", description: "إضافة وتعديل وحذف المستخدمين" },
            { id: "messages", name: "رسائل اتصل بنا", description: "عرض وإدارة رسائل اتصل بنا" },
            { id: "services", name: "طلبات الخدمات", description: "إدارة طلبات الخدمات" },
            { id: "ads", name: "الإعلانات", description: "إدارة الإعلانات والعروض" },
            { id: "contact", name: "بيانات الاتصال", description: "إدارة بيانات الاتصال" },
            { id: "settings", name: "الإعدادات", description: "تعديل إعدادات النظام" }
        ];

        // الأدوار والصلاحيات الافتراضية
        const rolePermissions = {
            admin: ["dashboard", "users", "messages", "services", "ads", "contact", "settings"],
            editor: ["dashboard", "messages", "services", "ads"],
            viewer: ["dashboard", "messages"]
        };

        let currentUserId = null;
        let currentFilter = 'all';

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            updateStats();
            setupEventListeners();
            initPermissions();
        });

        // تحميل المستخدمين في الجدول
        function loadUsers(filter = 'all') {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            let filteredUsers = [...users];
            
            if (filter !== 'all') {
                if (['admin', 'editor', 'viewer'].includes(filter)) {
                    filteredUsers = users.filter(user => user.role === filter);
                } else if (['active', 'inactive'].includes(filter)) {
                    filteredUsers = users.filter(user => user.status === filter);
                }
            }
            
            filteredUsers.forEach(user => {
                const fullName = `${user.firstName} ${user.lastName}`;
                const initials = getInitials(user.firstName, user.lastName);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>
                        <div class="user-info-cell">
                            <div class="user-avatar-small">${initials}</div>
                            <div class="user-details">
                                <div class="user-name-cell">${fullName}</div>
                                <div class="user-email-cell">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="role-badge role-${user.role}">${getRoleText(user.role)}</span></td>
                    <td>${user.joinDate}</td>
                    <td><span class="status-badge status-${user.status}">${getStatusText(user.status)}</span></td>
                    <td>${user.lastActivity}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-info" onclick="viewUser(${user.id})">
                                <i class="fas fa-eye"></i> عرض
                            </button>
                            <button class="btn btn-small btn-warning" onclick="openEditUserModal(${user.id})">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="btn btn-small btn-danger" onclick="openDeleteConfirmation(${user.id})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // تحديث الإحصائيات
            updateStats();
        }

        // الحصول على الأحرف الأولى
        function getInitials(firstName, lastName) {
            return (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();
        }

        // الحصول على نص الدور
        function getRoleText(role) {
            const roleMap = {
                'admin': 'مدير',
                'editor': 'محرر',
                'viewer': 'مشاهد'
            };
            return roleMap[role] || role;
        }

        // الحصول على نص الحالة
        function getStatusText(status) {
            const statusMap = {
                'active': 'نشط',
                'inactive': 'غير نشط',
                'suspended': 'موقوف'
            };
            return statusMap[status] || status;
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // البحث
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchUsers(e.target.value);
            });
            
            // مرشحات القائمة
            document.querySelectorAll('.filter-option').forEach(option => {
                option.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    
                    // تحديث القائمة المفتوحة
                    document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // تحديث النص الظاهر
                    document.getElementById('filterText').textContent = this.textContent;
                    
                    // إغلاق القائمة
                    document.getElementById('filterMenu').classList.remove('active');
                    
                    // تحميل البيانات
                    currentFilter = filter;
                    loadUsers(filter);
                });
            });
        }

        // تهيئة الصلاحيات في النماذج
        function initPermissions() {
            const addGrid = document.getElementById('addPermissionsGrid');
            const editGrid = document.getElementById('editPermissionsGrid');
            const viewGrid = document.getElementById('viewPermissionsGrid');
            
            allPermissions.forEach(permission => {
                // لشاشة الإضافة
                const addPermissionItem = createPermissionCheckbox(permission, 'add');
                addGrid.appendChild(addPermissionItem);
                
                // لشاشة التعديل
                const editPermissionItem = createPermissionCheckbox(permission, 'edit');
                editGrid.appendChild(editPermissionItem);
                
                // لشاشة العرض (قراءة فقط)
                const viewPermissionItem = createPermissionView(permission);
                viewGrid.appendChild(viewPermissionItem);
            });
            
            // تحديث الصلاحيات عند تغيير الدور في شاشة الإضافة
            document.getElementById('addRole').addEventListener('change', function() {
                updatePermissionsByRole('add', this.value);
            });
            
            // تحديث الصلاحيات عند تغيير الدور في شاشة التعديل
            document.getElementById('editRole').addEventListener('change', function() {
                updatePermissionsByRole('edit', this.value);
            });
        }

        // إنشاء خانة اختيار للصلاحية
        function createPermissionCheckbox(permission, mode) {
            const container = document.createElement('div');
            container.className = 'permission-item';
            container.innerHTML = `
                <input type="checkbox" id="${mode}_permission_${permission.id}" 
                       name="permissions" value="${permission.id}">
                <label class="permission-label" for="${mode}_permission_${permission.id}">
                    ${permission.name}
                    <br><small style="color: rgba(255,255,255,0.5);">${permission.description}</small>
                </label>
            `;
            return container;
        }

        // إنشاء عرض للصلاحية (قراءة فقط)
        function createPermissionView(permission) {
            const container = document.createElement('div');
            container.className = 'permission-item';
            container.id = `view_permission_${permission.id}`;
            container.innerHTML = `
                <i class="fas fa-check-circle" style="color: var(--success); display: none;"></i>
                <label class="permission-label">
                    ${permission.name}
                    <br><small style="color: rgba(255,255,255,0.5);">${permission.description}</small>
                </label>
            `;
            return container;
        }

        // تحديث الصلاحيات بناءً على الدور المختار
        function updatePermissionsByRole(mode, role) {
            const permissions = rolePermissions[role] || [];
            
            allPermissions.forEach(permission => {
                const checkbox = document.getElementById(`${mode}_permission_${permission.id}`);
                if (checkbox) {
                    checkbox.checked = permissions.includes(permission.id);
                    
                    // إذا كان الدور هو مدير، اجعل جميع الصلاحيات مقفلة
                    if (role === 'admin') {
                        checkbox.disabled = true;
                    } else {
                        checkbox.disabled = false;
                    }
                }
            });
        }

        // تحديث الإحصائيات
        function updateStats() {
            const totalCount = users.length;
            const activeCount = users.filter(user => user.status === 'active').length;
            const inactiveCount = users.filter(user => user.status === 'inactive').length;
            const adminCount = users.filter(user => user.role === 'admin').length;
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('activeCount').textContent = activeCount;
            document.getElementById('inactiveCount').textContent = inactiveCount;
            document.getElementById('adminCount').textContent = adminCount;
        }

        // البحث في المستخدمين
        function searchUsers(query) {
            const rows = document.querySelectorAll('#usersTableBody tr');
            const searchTerm = query.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // تبديل قائمة المرشحات
        function toggleFilterMenu() {
            const menu = document.getElementById('filterMenu');
            menu.classList.toggle('active');
        }

        // عرض تفاصيل المستخدم
        function viewUser(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            currentUserId = id;
            
            // تعبئة البيانات في الشاشة المنبثقة
            const fullName = `${user.firstName} ${user.lastName}`;
            const initials = getInitials(user.firstName, user.lastName);
            
            document.getElementById('viewFullName').textContent = fullName;
            document.getElementById('viewUserRole').textContent = getRoleText(user.role);
            document.getElementById('viewAvatarInitials').textContent = initials;
            document.getElementById('viewUsername').textContent = user.username;
            document.getElementById('viewEmail').textContent = user.email;
            document.getElementById('viewPhone').textContent = user.phone;
            document.getElementById('viewJoinDate').textContent = user.joinDate;
            document.getElementById('viewLastActivity').textContent = user.lastActivity;
            document.getElementById('viewLastIP').textContent = user.lastIP;
            
            // تحديث الدور والحالة
            const roleElement = document.getElementById('viewRoleBadge');
            roleElement.textContent = getRoleText(user.role);
            roleElement.className = `role-badge role-${user.role}`;
            
            const statusElement = document.getElementById('viewStatusBadge');
            statusElement.textContent = getStatusText(user.status);
            statusElement.className = `status-badge status-${user.status}`;
            
            // تحديث الصلاحيات
            updatePermissionsView(user.permissions);
            
            openModal('viewModal');
        }

        // تحديث عرض الصلاحيات
        function updatePermissionsView(userPermissions) {
            allPermissions.forEach(permission => {
                const viewItem = document.getElementById(`view_permission_${permission.id}`);
                const icon = viewItem.querySelector('i');
                
                if (userPermissions.includes(permission.id)) {
                    icon.style.display = 'inline-block';
                } else {
                    icon.style.display = 'none';
                }
            });
        }

        // تفعيل المستخدم
        function activateUser() {
            const index = users.findIndex(u => u.id === currentUserId);
            
            if (index === -1) return;
            
            users[index].status = 'active';
            users[index].lastActivity = new Date().toLocaleString('ar-SA');
            
            // تحديث العرض
            const statusElement = document.getElementById('viewStatusBadge');
            statusElement.textContent = 'نشط';
            statusElement.className = 'status-badge status-active';
            
            // إعادة تحميل الجدول
            loadUsers(currentFilter);
            
            // إظهار رسالة النجاح
            alert('تم تفعيل المستخدم بنجاح!');
        }

        // فتح شاشة إضافة مستخدم جديد
        function openAddUserModal() {
            // تفريغ النماذج
            document.getElementById('addUserForm').reset();
            
            // تعيين القيم الافتراضية
            document.getElementById('addStatus').value = 'active';
            document.getElementById('addRole').value = '';
            
            // تحديث الأفاتار
            updateAddAvatar();
            
            // إعادة تعيين الصلاحيات
            updatePermissionsByRole('add', '');
            
            openModal('addModal');
        }

        // تحديث الأفاتار في شاشة الإضافة
        function updateAddAvatar() {
            const firstName = document.getElementById('addFirstName').value;
            const lastName = document.getElementById('addLastName').value;
            const initials = getInitials(firstName || 'م', lastName || 'س');
            document.getElementById('addAvatarInitials').textContent = initials;
        }

        // حفظ مستخدم جديد
        function saveNewUser() {
            const firstName = document.getElementById('addFirstName').value;
            const lastName = document.getElementById('addLastName').value;
            const username = document.getElementById('addUsername').value;
            const email = document.getElementById('addEmail').value;
            const password = document.getElementById('addPassword').value;
            const confirmPassword = document.getElementById('addConfirmPassword').value;
            const phone = document.getElementById('addPhone').value;
            const role = document.getElementById('addRole').value;
            const status = document.getElementById('addStatus').value;
            
            // التحقق من البيانات
            if (!firstName || !lastName || !username || !email || !password || !role) {
                alert('يرجى ملء جميع الحقول المطلوبة!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('كلمتا المرور غير متطابقتين!');
                return;
            }
            
            if (password.length < 6) {
                alert('كلمة المرور يجب أن تكون 6 أحرف على الأقل!');
                return;
            }
            
            // التحقق من عدم تكرار اسم المستخدم والبريد الإلكتروني
            if (users.some(u => u.username === username)) {
                alert('اسم المستخدم موجود مسبقاً!');
                return;
            }
            
            if (users.some(u => u.email === email)) {
                alert('البريد الإلكتروني موجود مسبقاً!');
                return;
            }
            
            // جمع الصلاحيات المختارة
            const selectedPermissions = [];
            document.querySelectorAll('#addPermissionsGrid input[type="checkbox"]:checked').forEach(checkbox => {
                selectedPermissions.push(checkbox.value);
            });
            
            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                firstName: firstName,
                lastName: lastName,
                username: username,
                email: email,
                phone: phone || '',
                role: role,
                status: status,
                joinDate: new Date().toISOString().split('T')[0],
                lastActivity: new Date().toLocaleString('ar-SA'),
                lastIP: '192.168.1.100',
                permissions: selectedPermissions.length > 0 ? selectedPermissions : rolePermissions[role] || []
            };
            
            users.push(newUser);
            
            // إعادة تحميل الجدول
            loadUsers(currentFilter);
            
            // إغلاق الشاشة المنبثقة
            closeModal('addModal');
            
            // إظهار رسالة النجاح
            alert('تم إضافة المستخدم بنجاح!');
        }

        // فتح شاشة تعديل المستخدم
        function openEditUserModal(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            currentUserId = id;
            
            // تعبئة البيانات في النموذج
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editFirstName').value = user.firstName;
            document.getElementById('editLastName').value = user.lastName;
            document.getElementById('editUsername').value = user.username;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editPhone').value = user.phone || '';
            document.getElementById('editRole').value = user.role;
            document.getElementById('editStatus').value = user.status;
            
            // تحديث الأفاتار
            updateEditAvatar();
            
            // تحديث الصلاحيات
            updatePermissionsByRole('edit', user.role);
            
            // تحديد الصلاحيات الحالية
            user.permissions.forEach(permission => {
                const checkbox = document.getElementById(`edit_permission_${permission}`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
            
            openModal('editModal');
        }

        // تحديث الأفاتار في شاشة التعديل
        function updateEditAvatar() {
            const firstName = document.getElementById('editFirstName').value;
            const lastName = document.getElementById('editLastName').value;
            const initials = getInitials(firstName || 'م', lastName || 'س');
            document.getElementById('editAvatarInitials').textContent = initials;
        }

        // حفظ التعديلات
        function saveEditUser() {
            const id = parseInt(document.getElementById('editUserId').value);
            const index = users.findIndex(u => u.id === id);
            
            if (index === -1) return;
            
            const firstName = document.getElementById('editFirstName').value;
            const lastName = document.getElementById('editLastName').value;
            const username = document.getElementById('editUsername').value;
            const email = document.getElementById('editEmail').value;
            const password = document.getElementById('editPassword').value;
            const phone = document.getElementById('editPhone').value;
            const role = document.getElementById('editRole').value;
            const status = document.getElementById('editStatus').value;
            
            // التحقق من البيانات
            if (!firstName || !lastName || !username || !email || !role) {
                alert('يرجى ملء جميع الحقول المطلوبة!');
                return;
            }
            
            // التحقق من عدم تكرار اسم المستخدم والبريد الإلكتروني (باستثناء المستخدم الحالي)
            if (users.some(u => u.username === username && u.id !== id)) {
                alert('اسم المستخدم موجود مسبقاً!');
                return;
            }
            
            if (users.some(u => u.email === email && u.id !== id)) {
                alert('البريد الإلكتروني موجود مسبقاً!');
                return;
            }
            
            // جمع الصلاحيات المختارة
            const selectedPermissions = [];
            document.querySelectorAll('#editPermissionsGrid input[type="checkbox"]:checked').forEach(checkbox => {
                selectedPermissions.push(checkbox.value);
            });
            
            const updatedUser = {
                ...users[index],
                firstName: firstName,
                lastName: lastName,
                username: username,
                email: email,
                phone: phone || '',
                role: role,
                status: status,
                lastActivity: new Date().toLocaleString('ar-SA'),
                permissions: selectedPermissions.length > 0 ? selectedPermissions : rolePermissions[role] || []
            };
            
            // إذا تم إدخال كلمة مرور جديدة
            if (password) {
                if (password.length < 6) {
                    alert('كلمة المرور يجب أن تكون 6 أحرف على الأقل!');
                    return;
                }
                // في التطبيق الحقيقي، هنا يتم تشفير كلمة المرور
            }
            
            users[index] = updatedUser;
            
            // إعادة تحميل الجدول
            loadUsers(currentFilter);
            
            // إغلاق الشاشة المنبثقة
            closeModal('editModal');
            
            // إظهار رسالة النجاح
            alert('تم حفظ التعديلات بنجاح!');
        }

        // فتح شاشة تأكيد الحذف
        function openDeleteConfirmation(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            // منع حذف المدير الرئيسي
            if (user.role === 'admin' && user.username === 'ahmed') {
                alert('لا يمكن حذف حساب المدير الرئيسي للنظام!');
                return;
            }
            
            currentUserId = id;
            openModal('deleteModal');
        }

        // فتح شاشة حذف من شاشة التعديل
        function openDeleteModal() {
            const user = users.find(u => u.id === currentUserId);
            if (!user) return;
            
            // منع حذف المدير الرئيسي
            if (user.role === 'admin' && user.username === 'ahmed') {
                alert('لا يمكن حذف حساب المدير الرئيسي للنظام!');
                return;
            }
            
            closeModal('editModal');
            openModal('deleteModal');
        }

        // تأكيد الحذف
        function confirmDelete() {
            const index = users.findIndex(u => u.id === currentUserId);
            
            if (index !== -1) {
                const userName = `${users[index].firstName} ${users[index].lastName}`;
                users.splice(index, 1);
                
                // إعادة تحميل الجدول
                loadUsers(currentFilter);
                
                // إغلاق الشاشات المنبثقة
                closeModal('deleteModal');
                closeModal('viewModal');
                closeModal('editModal');
                
                // إظهار رسالة النجاح
                alert(`تم حذف المستخدم "${userName}" بنجاح!`);
            }
        }

        // فتح شاشة التعديل من شاشة العرض
        function openEditUserModal() {
            closeModal('viewModal');
            openEditUserModal(currentUserId);
        }

        // تبديل عرض كلمة المرور
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const toggleBtn = input.parentNode.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                toggleBtn.className = 'fas fa-eye';
            }
        }

        // فتح الشاشة المنبثقة
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // إغلاق الشاشة المنبثقة
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // النقر خارج الشاشة المنبثقة لإغلاقها
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    const modalId = this.id;
                    closeModal(modalId);
                }
            });
        });

        // إغلاق قائمة المرشحات عند النقر خارجها
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.filter-dropdown')) {
                document.getElementById('filterMenu').classList.remove('active');
            }
        });
    </script>
</body>
</html>